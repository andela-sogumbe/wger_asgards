machine:
    python:
        version: 3.5.2
dependencies:
    pre:
        - pip install -r requirements_devel.txt
        - invoke create_settings --settings-path ./wger/settings.py --database-path ./wger/database.sqlite
        - invoke bootstrap_wger --settings-path ./wger/settings.py --no-start-server

test:
    pre:
        - python manage.py migrate
    override:
        - python manage.py test
deployment:
    staging:
        branch: develop
        commands:
            - git fetch origin --unshallow
            - git push -f git@heroku.com:wger-alphas.git $CIRCLE_SHA1:refs/heads/master
            - heroku run python manage.py collectstatic --app wger-alphas
            - heroku run python manage.py makemigrations --app wger-alphas
            - heroku run python manage.py migrate --app wger-akira
            - heroku ps:scale web=1 --app wger-alphas
